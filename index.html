<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Flip Slideshow (01–22)</title>
  <style>
    :root{
      --bg:#0b0c0f; --panel:#12141a; --text:#e9ecf1; --muted:#98a2b3;
      --accent:#3b82f6; --ring:rgba(59,130,246,.5);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--text);
      background:radial-gradient(1200px 800px at 50% -20%,#1a2030 0%,var(--bg) 60%);
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans";
      display:grid; grid-template-rows:auto 1fr auto; gap:16px;
    }

    /* Top bar with Flip button centered */
    .topbar{
      display:grid; grid-template-columns:1fr auto 1fr; align-items:center; gap:12px;
      padding:12px clamp(12px,3vw,28px);
      background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,0));
      border-bottom:1px solid rgba(255,255,255,.06);
      backdrop-filter:blur(6px);
      position:sticky; top:0; z-index:10;
    }
    .left,.right{display:flex;align-items:center;gap:8px}
    .center{display:flex;align-items:center;gap:10px;justify-content:center}

    button{
      appearance:none;border:0;cursor:pointer;color:var(--text);background:#1c2230;
      padding:10px 14px;border-radius:12px;font-weight:600;
      box-shadow:inset 0 0 0 1px rgba(255,255,255,.06),0 2px 8px rgba(0,0,0,.25);
      transition:transform .06s ease,box-shadow .2s ease,background .2s ease;
    }
    button:hover{background:#222a3a}
    button:active{transform:translateY(1px)}
    button:focus-visible{outline:2px solid var(--ring); outline-offset:2px}
    .primary{
      background:linear-gradient(180deg,#2955c6,#1f45ab);
      box-shadow:inset 0 0 0 1px rgba(255,255,255,.08),0 4px 14px rgba(41,85,198,.45);
    }
    .primary:hover{background:linear-gradient(180deg,#2f63e6,#244fbe)}
    .progress{font-size:14px;color:var(--muted);letter-spacing:.2px}

    .stage{display:grid;place-items:center;padding:clamp(10px,4vw,28px)}
    .frame{
      position:relative;width:min(92vw,920px);
      aspect-ratio:3/4; /* will be updated per image to avoid cropping */
      perspective:1600px;
      background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));
      border-radius:18px; overflow:hidden;
      box-shadow:0 20px 60px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.05);
      isolation:isolate;
    }

    .card{position:absolute;inset:0;transform-style:preserve-3d;transition:transform 660ms cubic-bezier(.22,.61,.36,1)}
    .card.no-anim{transition:none !important} /* instant when paging */
    .card.flipped{transform:rotateY(180deg)}

    .card-face{
      position:absolute;inset:0;display:grid;place-items:center;
      backface-visibility:hidden;-webkit-backface-visibility:hidden;
      background:#0f1218;
    }
    .card-back{transform:rotateY(180deg)}
    .card-face img{
      max-width:100%; max-height:100%; width:auto; height:auto; /* prevent cropping */
      object-fit:contain; image-rendering:-webkit-optimize-contrast; background:#0f1218;
    }

    /* side nav arrows */
    .nav{
      position:absolute; top:50%; transform:translateY(-50%);
      display:flex;align-items:center;justify-content:center;
      width:clamp(36px,5vw,52px); height:clamp(36px,5vw,52px);
      border-radius:50%; background:rgba(0,0,0,.35);
      box-shadow:0 1px 8px rgba(0,0,0,.35);
      user-select:none; -webkit-user-select:none;
    }
    .nav:hover{background:rgba(0,0,0,.45)}
    .nav:active{transform:translateY(-50%) scale(.98)}
    .prev{left:10px} .next{right:10px}

    .kbd{font:600 12px/1 ui-monospace,Menlo,Consolas,monospace;background:#172033;color:#cfe1ff;padding:4px 6px;border-radius:8px;box-shadow:inset 0 0 0 1px rgba(255,255,255,.08)}
    .footer{text-align:center;color:var(--muted);font-size:13px;padding:8px 16px 18px}
    .toast{position:fixed;bottom:16px;left:50%;transform:translateX(-50%);background:rgba(20,24,32,.9);color:var(--text);padding:10px 14px;border-radius:12px;box-shadow:0 6px 24px rgba(0,0,0,.35);opacity:0;pointer-events:none;transition:opacity .25s ease}
    .toast.show{opacity:1}
  </style>
</head>
<body>
  <!-- Flip button ABOVE the card (sticky) -->
  <header class="topbar" role="banner">
    <div class="left">
      <button id="prevBtn" aria-label="Previous card" title="Previous (←)">◀</button>
    </div>
    <div class="center">
      <button id="flipBtn" class="primary" aria-label="Flip card" title="Flip (F or Space)">Flip</button>
      <div class="progress" id="progressText" aria-live="polite"></div>
    </div>
    <div class="right">
      <button id="nextBtn" aria-label="Next card" title="Next (→)">▶</button>
    </div>
  </header>

  <main class="stage" role="main">
    <div class="frame" id="frame">
      <div class="card" id="card" aria-live="polite" aria-atomic="true">
        <div class="card-face card-front" aria-label="Front">
          <img id="frontImg" alt="Front image" />
        </div>
        <div class="card-face card-back" aria-label="Back">
          <img id="backImg" alt="Back image" />
        </div>
      </div>
      <button class="nav prev" id="prevNav" aria-label="Previous card">◀</button>
      <button class="nav next" id="nextNav" aria-label="Next card">▶</button>
    </div>
  </main>

  <div class="footer">
    Tip: Use <span class="kbd">←</span>/<span class="kbd">→</span> to switch cards, <span class="kbd">F</span> or <span class="kbd">Space</span> to flip. Click/tap the card to flip. Swipe left/right on mobile.
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    // === CONFIG ===
    const TOTAL_IMAGES = 22;           // 01.jpg … 22.jpg
    const IMAGES_PER_CARD = 2;         // odd = front, even = back
    const TOTAL_CARDS = Math.floor(TOTAL_IMAGES / IMAGES_PER_CARD);

    // === STATE ===
    let cardIndex = 0; // 0..TOTAL_CARDS-1
    let flipped = false;

    // === ELs ===
    const frame = document.getElementById('frame');
    const card = document.getElementById('card');
    const frontImg = document.getElementById('frontImg');
    const backImg  = document.getElementById('backImg');
    const progressText = document.getElementById('progressText');
    const toast = document.getElementById('toast');

    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const flipBtn = document.getElementById('flipBtn');
    const prevNav = document.getElementById('prevNav');
    const nextNav = document.getElementById('nextNav');

    // === HELPERS ===
    const pad2  = n => n.toString().padStart(2,'0');
    const fileOf = n => `${pad2(n)}.jpg`;

    function imageNumsForCard(idx){
      const frontN = idx*2 + 1; // 1-based
      const backN  = Math.min(frontN + 1, TOTAL_IMAGES);
      return {frontN, backN};
    }

    // Avoid cropping: set frame aspect to image natural ratio
    function setAspectFrom(img){
      const apply = () => {
        const w = img.naturalWidth || 0, h = img.naturalHeight || 0;
        if (w>0 && h>0) frame.style.aspectRatio = `${w} / ${h}`;
      };
      if (img.complete) apply(); else img.addEventListener('load', apply, {once:true});
    }

    function preloadAround(frontN){
      const to = new Set();
      for(let n=Math.max(1, frontN-4); n<=Math.min(TOTAL_IMAGES, frontN+6); n++) to.add(n);
      to.forEach(n => { const i=new Image(); i.src=fileOf(n); });
    }

    function updateUI(){
      const {frontN, backN} = imageNumsForCard(cardIndex);
      frontImg.src = fileOf(frontN);
      backImg.src  = fileOf(backN);
      setAspectFrom(frontImg);

      // keep current flip state
      card.classList.toggle('flipped', flipped);

      const cardNum = `${cardIndex+1} / ${TOTAL_CARDS}`;
      const face = flipped ? 'Back' : 'Front';
      progressText.textContent = `Card ${cardNum} • ${face} (${pad2(flipped? backN : frontN)}.jpg)`;

      preloadAround(frontN);
    }

    function flip(){
      flipped = !flipped;
      card.classList.toggle('flipped', flipped);
      const {frontN, backN} = imageNumsForCard(cardIndex);
      progressText.textContent = `Card ${cardIndex+1} / ${TOTAL_CARDS} • ${flipped?'Back':'Front'} (${pad2(flipped?backN:frontN)}.jpg)`;
    }

    function goto(offset){
      const target = cardIndex + offset;
      if (target < 0 || target > TOTAL_CARDS-1){
        note(target<0 ? 'First card' : 'Last card'); return;
      }
      cardIndex = target;
      flipped = false;

      // make prev/next feel instant (don’t wait for flip animation)
      card.classList.add('no-anim');
      card.classList.remove('flipped');
      void card.offsetHeight; // reflow
      updateUI();
      requestAnimationFrame(()=>card.classList.remove('no-anim'));
    }
    const nextCard = () => goto(+1);
    const prevCard = () => goto(-1);

    function note(msg){
      toast.textContent = msg; toast.classList.add('show');
      clearTimeout(note._t); note._t = setTimeout(()=>toast.classList.remove('show'), 900);
    }

    // === EVENTS ===
    flipBtn.addEventListener('click', flip);
    prevBtn.addEventListener('click', prevCard);
    nextBtn.addEventListener('click', nextCard);
    prevNav.addEventListener('click', prevCard);
    nextNav.addEventListener('click', nextCard);

    // flip by clicking the card (ignore clicks on buttons)
    frame.addEventListener('click', (e)=>{
      if (e.target.closest('button')) return;
      flip();
    });

    // keyboard
    window.addEventListener('keydown', (e)=>{
      if (['INPUT','TEXTAREA','SELECT'].includes(document.activeElement?.tagName)) return;
      if (e.key==='ArrowRight'){ e.preventDefault(); nextCard(); }
      else if (e.key==='ArrowLeft'){ e.preventDefault(); prevCard(); }
      else if (e.key.toLowerCase()==='f' || e.code==='Space'){ e.preventDefault(); flip(); }
      else if (e.key==='Home'){ cardIndex=0; flipped=false; updateUI(); }
      else if (e.key==='End'){ cardIndex=TOTAL_CARDS-1; flipped=false; updateUI(); }
    });

    // swipe (pointer)
    let startX=0,startY=0,moved=false;
    frame.addEventListener('pointerdown',(e)=>{startX=e.clientX;startY=e.clientY;moved=false;frame.setPointerCapture(e.pointerId);});
    frame.addEventListener('pointermove',(e)=>{ if (Math.abs(e.clientX-startX)>6 || Math.abs(e.clientY-startY)>6) moved=true; });
    frame.addEventListener('pointerup',(e)=>{
      const dx=e.clientX-startX, dy=e.clientY-startY;
      const ax=Math.abs(dx), ay=Math.abs(dy); const SWIPE=40;
      if (ax>ay && ax>SWIPE){ if (dx<0) nextCard(); else prevCard(); }
      else if (!moved){ flip(); }
      frame.releasePointerCapture(e.pointerId);
    });

    // init
    updateUI();
  </script>
</body>
</html>
